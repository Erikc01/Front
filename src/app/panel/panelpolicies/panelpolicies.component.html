<ngx-spinner
  bdColor="rgba(51,51,51,0.8)"
  size="medium"
  color="#fff"
  type="" style="height:100 vh">
    <div class="preloader-wrapper big active">
        <div class="spinner-layer spinner-blue-only">
          <div class="circle-clipper left">
            <div class="circle"></div>
          </div><div class="gap-patch">
            <div class="circle"></div>
          </div><div class="circle-clipper right">
            <div class="circle"></div>
          </div>
        </div>
    </div> 
</ngx-spinner>
<section style="padding-top: 0px">
	<div class="row">
    	<div class="col m6">
        	<h2>Pólizas</h2>
        </div>
        <div class="col m3">
            <br>
            <div class="input-field">
                <input type="text" id="autocomplete-input" class="autocomplete" (change)="searchPolicies()" placeholder="Buscar póliza">
            </div>
        </div>
        <div class="col m3">
            <br>
            <div  class="input-field">
                <select (change)="setFilters()" [(ngModel)]="filters" multiple >
                    <option value=""  selected disabled>Filtrar pólizas</option>
                    <option value="policy_states,active">Pólizas activas</option>
                    <option value="policy_states,canceled">Pólizas canceladas</option>
                    <option value="policy_states,suspended">Pólizas vencidas</option>
                    <option value="km_states,km_left">Pólizas con kilómetros disponibles</option>
                    <option value="km_states,no_km_left">Pólizas sin kilómetros disponibles</option>
                    <option value="km_states,uncovered_km">Pólizas sin cobertura</option>
                    <option value="membership_states,paid">Pólizas con membresía pagada</option>
                    <option value="membership_states,unpaid">Pólizas sin membresía pagada</option>
                    <option value="seller_states,assigned">Pólizas con vendedor asignado</option>
                    <option value="seller_states,unassigned">Pólizas sin vendedor asignado</option>
                    <option value="device_states,connected">Pólizas con dispositivo conectado</option>
                    <option value="device_states,disconnected">Pólizas sin dispositivo conectado</option>
                    <option value="device_states,assigned">Pólizas con dispositivo asignado</option>
                    <option value="device_states,unassigned">Pólizas sin dispositivo asignado</option>
                    <option value="vin_states,true">Pólizas con vin</option>
                    <option value="vin_states,false">Pólizas sin vin</option>
                </select>
            </div>
		</div>
    </div>
    <div class="row">
        <div class="col m12">
            <table class="highlight striped responsive-table">
                <thead>
                    <tr>
                        <th>Póliza</th>
                        <th>Titular</th>
                        <th>Vehículo</th>
                        <th>Próximo pago</th>
                        <th>Estatus</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let policy of policies">
                        <td>
                            <a *ngIf="policy.status!='canceled'" href= "http://dev2.sxkm.mx/panel/imprimir-certificado?policy_id={{policy.id}}" target="_blank">
                                SXKM: {{policy.sxkm_id}} <br>
                                AIG: {{policy.aig_id}}
                            </a>
                            <span *ngIf="policy.status=='canceled'">
                                SXKM: {{policy.sxkm_id}} <br>
                                AIG: {{policy.aig_id}}
                            </span>
                            <br>
                            <span *ngIf="policy.seller.id!=null">
                                {{policy.seller.full_name}}
                            </span>
                            <span *ngIf="policy.seller.id==null">
                                Sin vendedor asignado
                            </span>
                        </td>
                        <td>
                            <span *ngIf="policy.user.first_name!=null">{{policy.user.first_name}} {{policy.user.last_name}} {{policy.user.second_last_name}}<br></span>
                            {{policy.user.email}} <br>
                            {{policy.phone}} <br>
                            Nivel PIA: {{policy.car.pia_level}}
                        </td>
                        <td>
                            {{policy.car.maker}} {{policy.car.year}} <br>
                            {{policy.car.version.substring(0, 50)}} <br>
                            Kilómetros disponibles: {{policy.car.km_left}}
                        </td>
                        <td>
                            {{policy.membership.next_cutoff_date | date: 'dd-MM-yyyy'}}
                        </td>
                        <td>
                            <span *ngIf="policy.status=='active' && policy.device.assigned==true && policy.device.connected==true && policy.car.km_left > 0 && policy.membership.status!='No Pagada'">
                                <i class="material-icons" style="font-size: 12px;color:#17d320">brightness_1</i> Activa
                            </span>
                            <span *ngIf="policy.status=='suspended'">
                                <i class="material-icons" style="font-size: 12px;color:red">brightness_1</i> Vencida <br>
                            </span>
                            <span *ngIf="policy.status=='canceled'">
                                <i class="material-icons" style="font-size: 12px;color:red">brightness_1</i> Cancelada <br>
                            </span>
                            <span *ngIf="policy.membership.status=='No Pagada'">
                                <i class="material-icons" style="font-size: 12px;color:red">brightness_1</i> Membresía no pagada <br>
                            </span>
                            <span *ngIf="policy.car.km_left <= 0">
                                <i class="material-icons" style="font-size: 12px;color:red">brightness_1</i> Sin kilómetros disponibles <br>
                            </span>
                            <span *ngIf="policy.device.assigned==false">
                                <i class="material-icons" style="font-size: 12px;color:red">brightness_1</i> Sin dispositivo asignado <br>
                            </span>
                            <span *ngIf="policy.device.assigned==true && policy.device.connected==false">
                                <i class="material-icons" style="font-size: 12px;color:red">brightness_1</i> Dispositivo desconectado <br>
                            </span>
                        </td>
                        <td>
                            <a *ngIf="policy.car.km_left <= 0" href="" class="tooltipped" data-position="top" data-tooltip="Modificar datos del cliente" style="cursor: pointer; font-size: 14px" >
                                <i class="material-icons" style="font-size:16px">attach_money</i> Recargar kilómetros <br>
                            </a>
                            <a *ngIf="policy.membership.status!='Pagada'" href="/panel/perfil/editar/{{policy.user.id}}" class="tooltipped" data-position="top" data-tooltip="Modificar datos del cliente" style="cursor: pointer; font-size: 14px" >
                                <i class="material-icons" style="font-size:16px">attach_money</i> Pagar membresía <br>
                            </a>

                            <a *ngIf="policy.status!='canceled'" href="/panel/poliza/editar/{{policy.id}}" class="tooltipped" data-position="top" data-tooltip="Modificar datos del cliente" style="cursor: pointer; font-size: 14px" >
                                <i class="material-icons" style="font-size:16px">directions_car</i> Ver auto <br>
                            </a>

                            <a *ngIf="policy.user.id" href="/panel/perfil/editar/{{policy.user.id}}" class="tooltipped" data-position="top" data-tooltip="Modificar datos del cliente" style="cursor: pointer; font-size: 14px" >
                                <i class="material-icons" style="font-size:16px">edit</i> Ver Perfil <br>
                            </a>

                            <a *ngIf="policy.status!='canceled'" href="/panel/perfil/editar/{{policy.user.id}}" class="tooltipped" data-position="top" data-tooltip="Modificar datos del cliente" style="cursor: pointer; font-size: 14px" >
                                <i class="material-icons" style="font-size:16px">battery_full</i> {{policy.device.assigned ? 'Cambiar dispositivo': 'Asignar dispositivo'}} <br>
                            </a>

                            <a *ngIf="policy.status!='canceled' && policy.device.connected==false && policy.device.assigned==true " href="/panel/perfil/editar/{{policy.user.id}}" class="tooltipped" data-position="top" data-tooltip="Modificar datos del cliente" style="cursor: pointer; font-size: 14px" >
                                <i class="material-icons" style="font-size:16px">battery_alert</i> Evento de dispositivo conectado <br>
                            </a>
                            
                            <a *ngIf="policy.status!='canceled'" class="tooltipped" data-position="top" data-tooltip="Imprimir etiqueta" style="cursor: pointer; font-size: 14px" >
                                <i class="material-icons" style="font-size:16px">print</i> Imprimir etiqueta <br>
                            </a>

                            <a *ngIf="policy.status!='canceled'" class="tooltipped" data-position="top" data-tooltip="Imprimir tarjeta" style="cursor: pointer; font-size: 14px" >
                                <i class="material-icons" style="font-size:16px">picture_in_picture</i> Tarjeta <br>
                            </a>

                            <a  *ngIf="policy.status!='canceled'" class="tooltipped  modal-trigger" data-position="top" data-tooltip="Ver detalle de póliza" style="cursor: pointer;" href="#modal1" style="cursor: pointer; font-size: 14px">
                                <i class="material-icons" style="font-size:16px">account_circle</i> Cambiar Vendedor <br>
                            </a>
                            <a  *ngIf="policy.status!='canceled'" class="tooltipped  modal-trigger" data-position="top" data-tooltip="Cancelar póliza" style="cursor: pointer;" href="#modal1" style="cursor: pointer; font-size: 14px">
                                <i class="material-icons" style="font-size:16px">cancel</i> Cancelar póliza <br>
                            </a>    
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="row">
        <div class="col m12" align="center">
            <ul class="pagination">
                <li class="waves-effect" (click)="setPagination(pagination[0]-1)"><a><i class="material-icons">chevron_left</i></a></li>
                <li *ngFor="let p of pagination" class="{{policies_info.page==p? 'active':'waves-effect'}}" (click)="setPagination(p)"><a>{{p}}</a></li>
                <li class="waves-effect" (click)="setPagination(pagination[9]+1)"><a><i class="material-icons">chevron_right</i></a></li>
            </ul>
        </div>
    </div>
</section>