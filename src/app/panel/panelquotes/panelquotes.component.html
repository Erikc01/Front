<ngx-spinner
bdColor = "rgba(51, 51, 51, 0.8)"
size = "large"
color = "#fff"
type = "ball-spin"
height="100%"
></ngx-spinner>

<section>
  <div class="container">
    <div class="row">
      <div class="col-md-6">
        <br>
        <h2>Cotizaciones</h2>
      </div>
      <div class="col-md-6">
        <br>
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Buscar cotización" [(ngModel)]="quote_info.term">
          <div class="input-group-append">
            <button class="btn btn-outline-secondary" type="button" (click)="searchQuote()">Buscar</button>
          </div>
        </div>
      </div>
      <div class="col-md-12">
        <table class="table table-striped">
          <thead>
            <tr>
              <th scope="col"># Cotización</th>
              <th scope="col">Datos personales</th>
              <th scope="col">Datos del auto</th>
              <th scope="col">Cotizaciones</th>
              <th scope="col">Status</th>
              <th scope="col">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let quote of quotes">
              <td>
                <a target="_blank" href="#" class="tooltipped" data-position="top" data-tooltip="Descarga la póliza" style="cursor: pointer;" >
                  {{quote.id}}
                </a> <br>
                <small>{{quote.created_at  | date: 'dd-MM-yyyy'}}</small> <br>
                <span *ngIf="quote.seller.id==null">
                  Sin vendedor asignado
                </span>
                <span *ngIf="quote.seller.id">{{quote.seller.full_name}}</span>
              </td>
              <td>
                <span *ngIf="quote.user.first_name!=null">Nombre: {{quote.user.first_name}} {{quote.user.last_name}} {{quote.user.second_last_name}} <br></span>
                Correo: {{quote.user.email}} <br>
                <span *ngIf="quote.user.phone!=''">Celular: {{quote.user.phone}}<br></span>
                Sexo: {{quote.user.gender==1?'Mujer':'Hombre'}} <br>
                Fecha nacimiento: {{quote.user.birth_date}} <br>
                CP: {{quote.user.zip_code}} 
              </td>
              <td>
                Marca: {{quote.car.maker}} <br>
                Año: {{quote.car.year}} <br>
                Modelo: {{quote.car.model}}
              </td>
              <td>
                <span *ngFor="let package of quote.packages_costs">
                  Paquete {{package.package}} km:{{package.total_cost | currency}} <br>
                </span>
              </td>
              <td>
                <span *ngIf="quote.status=='pending'">
                  <i class="material-icons" style="font-size: 12px;color:#17d320">brightness_1</i> Activa
                </span>
                <span *ngIf="quote.status=='canceled_unpaid'">
                  <i class="material-icons" style="font-size: 12px;color:#d31717">brightness_1</i> Caducada
                </span>
              </td>
              <td>
                <a class="tooltipped  modal-trigger" data-position="top" data-tooltip="Ver detalle de póliza" style="cursor: pointer;font-size: 14px" href="#modal1" (click)="changeSellerModal(quote.id,quote.seller.id)">
                  <i class="material-icons" style="font-size:16px">account_circle</i>
                  {{quote.seller.id==null ?'Asignar vendedor':'Cambiar vendedor'}}
                  <br>
                </a>
                <a *ngIf="quote.user.id!=null" href="/panel/perfil/editar/1040" class="tooltipped" data-position="top" data-tooltip="Modificar datos del cliente" style="cursor: pointer; font-size: 14px" >
                  <i class="material-icons" style="font-size:16px">edit</i> Ver Perfil <br>
                </a>
                <a *ngIf="quote.status=='pending'" href="/panel/pago/compra/{{quote.id}}" class="tooltipped" data-position="top" data-tooltip="Modificar datos del cliente" style="cursor: pointer; font-size: 14px" >
                  <i class="material-icons" style="font-size:16px">payment</i> Pagar cotización
                  <br>
                </a>
                <a  *ngIf="quote.status=='pending'" class="tooltipped modal-trigger" data-position="top" data-tooltip="Enviar cotización por correo" style="cursor: pointer; font-size: 14px" (click)="setEmailQuote(quote.id, quote.user.email)"  href="#modal4">
                  <i class="material-icons" style="font-size:16px">email</i> Enviar cotización por correo
                  <br>
                </a>
                <a href="#id_modal_cotizador" (click)="setQuotation(quote)" class="tooltipped modal-trigger" data-position="top" data-tooltip="Recotizar" style="cursor: pointer; font-size: 14px" >
                  <i class="material-icons" style="font-size:16px">autorenew</i> Recotizar
                  <br>
                </a>
                <a  *ngIf="quote.status=='pending'" href="#modal3" (click)="deleteQuote(quote.id)" class="tooltipped modal-trigger" data-position="top" data-tooltip="Eliminar cotización" style="cursor: pointer; font-size: 14px" >
                  <i class="material-icons" style="font-size:16px">delete</i> Elimiar 
                </a>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>