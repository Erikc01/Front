<ngx-spinner
  bdColor="rgba(51,51,51,0.8)"
  size="medium"
  color="#fff"
  type="" style="height:100 vh">
    <div class="preloader-wrapper big active">
        <div class="spinner-layer spinner-blue-only">
          <div class="circle-clipper left">
            <div class="circle"></div>
          </div><div class="gap-patch">
            <div class="circle"></div>
          </div><div class="circle-clipper right">
            <div class="circle"></div>
          </div>
        </div>
    </div> 
</ngx-spinner>
<section style="padding-top: 0px">
        <div class="row">
            <div class="col m6">
                <h2>Cotizaciones</h2>
            </div>
            <div class="col m3">
                <br>
                <div class="input-field">
                    <input [(ngModel)]="quote_info.term" type="text" id="autocomplete-input" class="autocomplete" (change)="searchQuote()" placeholder="Buscar cotización">
                </div>
            </div>
            <div class="col m3">
                <br>
                <div  class="input-field">
                    <select (change)="setFilters()" [(ngModel)]="filters" multiple >
                        <option value=""  disabled>Filtrar cotizaciones</option>
                        <option value="quote_states,pending">Cotizaciones activas</option>
                        <option value="quote_states,canceled_unpaid">Cotizaciones caducadas</option>
                        <option value="seller_states,assigned">Cotizaciones con vendedor asignado</option>
                        <option value="seller_states,unassigned">Cotizaciones sin vendedor asignado</option>
                        <option value="payment_states,pending">Cotizaciones con ficha de pago</option>
                        <option value="payment_states,not_pending">Cotizaciones sin ficha de pago</option>
                    </select>
                </div>
            </div>
            <div class="col m12">
                <table class="striped" style="width:100%">
                    <thead>
                        <tr>
                            <th># Cotización</th>
                            <th>Datos personales</th>
                            <th>Datos del auto</th>
                            <th>Cotizaciones</th>
                            <th>Status</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr  *ngFor="let quote of quotes">
                            <td>
                                <a target="_blank" href="#" class="tooltipped" data-position="top" data-tooltip="Descarga la póliza" style="cursor: pointer;" >
                                    {{quote.id}}
                                </a> <br>
                                <small>{{quote.created_at  | date: 'shortDate'}}</small> <br>
                                {{quote.seller.full_name}}
                            </td>
                            <td>
                                <span *ngIf="quote.user.name!=null">Nombre: {{quote.user.name}} <br></span>
                                <span *ngIf="quote.user.phone!=''">Celular: {{quote.user.phone}}<br></span>
                                Correo: {{quote.user.email}} <br>
                                Sexo: {{quote.user.gender==1?'Mujer':'Hombre'}} <br>
                                Fecha nacimiento: {{quote.user.birth_date}} <br>
                                CP: {{quote.user.zip_code}} 
                            </td>
                            <td>
                                Marca: {{quote.car.maker}} <br>
                                Año: {{quote.car.year}} <br>
                                Modelo: {{quote.car.model}}
                            </td>
                            <td>
                                <span *ngFor="let package of quote.packages_costs">
                                    Paquete {{package.package}} km:{{package.total_cost | currency}} <br>
                                </span>
                            </td>
                            <td>
                                <span *ngIf="quote.status=='pending'">
                                    <i class="material-icons" style="font-size: 12px;color:#17d320">brightness_1</i> Activa
                                </span>
                                <span *ngIf="quote.status=='canceled_unpaid'">
                                        <i class="material-icons" style="font-size: 12px;color:#d31717">brightness_1</i> Caducada
                                </span>
                            </td>
                            <td>
                                <a class="tooltipped  modal-trigger" data-position="top" data-tooltip="Ver detalle de póliza" style="cursor: pointer;" href="#modal1" (click)="changeSellerModal(quote.id,quote.seller.id)">
                                    <i class="material-icons" style="font-size:16px">account_circle</i>
                                    {{quote.seller.id==null ?'Asignar vendedor':'Cambiar vendedor'}}
                                    <br>
                                </a>
                                <a *ngIf="quote.user.id!=null" href="/panel/perfil/editar/1040" class="tooltipped" data-position="top" data-tooltip="Modificar datos del cliente" style="cursor: pointer; font-size: 12px" >
                                    <i class="material-icons">edit</i> Ver Perfil <br>
                                </a>
                                <a *ngIf="quote.status=='pending'" href="/panel/pago/compra/{{quote.id}}" class="tooltipped" data-position="top" data-tooltip="Modificar datos del cliente" style="cursor: pointer; font-size: 14px" >
                                    <i class="material-icons" style="font-size:16px">payment</i> Pagar cotización
                                    <br>
                                </a>
                                <a class="tooltipped" data-position="top" data-tooltip="Enviar cotización por correo" style="cursor: pointer; font-size: 12px" (click)="sendEmailQuote(quote.id)">
                                    <i class="material-icons" style="font-size:16px">email</i> Enviar cotización por correo
                                    <br>
                                </a>
                                <a href="#id_modal_cotizador" (click)="setQuotation(quote)" class="tooltipped modal-trigger" data-position="top" data-tooltip="Recotizar" style="cursor: pointer; font-size: 14px" >
                                    <i class="material-icons" style="font-size:16px">autorenew</i> Recotizar
                                    <br>
                                </a>
                                <a href="#modal3" (click)="deleteQuote(quote.id)" class="tooltipped modal-trigger" data-position="top" data-tooltip="Eliminar cotización" style="cursor: pointer; font-size: 14px" >
                                    <i class="material-icons" style="font-size:16px">delete</i> Elimiar 
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="row">
            <div class="col m12" align="center">
                <ul class="pagination">
                    <li class="waves-effect" (click)="setPagination(pagination[0]-1)"><a><i class="material-icons">chevron_left</i></a></li>
                    <li *ngFor="let p of pagination" class="{{page==p? 'active':'waves-effect'}}" (click)="setPagination(p)"><a>{{p}}</a></li>
                    <li class="waves-effect" (click)="setPagination(pagination[9]+1)"><a><i class="material-icons">chevron_right</i></a></li>
                </ul>
            </div>
        </div>
</section>


<!--Modales-->
<!-- Cambiar vendedor -->
<div id="modal1" class="modal">
    <div class="modal-content">
        <h4>Asignar vendedor</h4>
        <select [(ngModel)]="seller_id" class="browser-default" required="true" minlength="3" >
            <option value="" disabled selected>Asignar Vendedor</option>
            <option *ngFor="let seller of sellers" value="{{seller.id}}">{{seller.full_name}} ({{seller.email}})</option>
        </select>
    </div>
    <div class="modal-footer">
        <a class="modal-close waves-effect waves-green btn-flat" (click)="changeSeller()" >Asignar vendedor</a>
    </div>
</div>


<!-- Cotizar auto -->
<div id="id_modal_cotizador" class="modal">
    <div class="modal-content">
        <form #f="ngForm" (ngSubmit)="onSubmit()" ngNativeValidate >
            <div class="row">
                <div class="col m12">
                    <h2>Cotizar auto</h2>
                </div>
                <div class="col m6">
                    <div class="row">
                        <div class="col m12">
                            <span style="font-size:16px">Datos de tu auto</span>
                        </div>
                        <div class="col m12" style="padding-bottom: 15px">
                            <select (change)="getModels();" class="browser-default " required="true" [(ngModel)]="quotation.maker" name="maker" #maker="ngModel" id="maker">
                                <option value="" disabled selected>Marca</option>
                                <option *ngFor="let maker of makers" value="{{maker.id}}">{{maker.name}}</option>
                            </select>
                        </div>
                        <div class="col m12" style="padding-bottom: 15px">
                            <select (change)="getModels()" class="browser-default" required="true" minlength="1" [(ngModel)]="quotation.year" name="year" #year="ngModel" id="year">
                                <option value="" disabled selected>Año</option>
                                <option *ngFor="let year of years" value="{{year}}">{{year}}</option>
                            </select>
                        </div>
                        <div class="col {{loaderModels==true? 'm10': 'm12'}}" style="padding-bottom: 15px">
                            <select  class="browser-default" required="true" minlength="3" [(ngModel)]="quotation.model" name="model" #model="ngModel" (change)="getVersions()" id="model" [disabled]="modelLength==0">
                                <option value="" disabled selected>Modelo</option>
                                <option *ngFor="let m of models" value="{{m.id}}">{{m.name}}</option>
                            </select>
                        </div>
                        <div *ngIf="loaderModels==true" class="col m2" align="left" style="padding-top: 15px">
                            <img src="/assets/img/spinner.gif" alt="" style="width: 32px;">
                        </div>
                        <div class="col {{loaderVersions==true? 'm10': 'm12'}}">
                            <select class="browser-default" required="true" minlength="1" [(ngModel)]="quotation.version" name="version" #version="ngModel"  (change)="getSisa(); setVersionName(1)" id="version"  [disabled]="versionLength==0">
                                <option value="" disabled selected>Versión </option>
                                <option *ngFor="let version of versions" value="{{version.id}}">{{version.name}}</option>
                            </select>
                        </div>
                        <div *ngIf="loaderVersions==true" class="col m2" align="left" style="padding-top: 10px">
                            <img src="/assets/img/spinner.gif" alt="" style="width: 32px;">
                        </div>
                    </div>
                </div>
                <div class="col m6">
                    <div class="row">
                        <div class="col m12">
                            <span style="font-size:16px">Datos personales</span>
                        </div>
                        <div class="col m12" style="padding-bottom: 5px">
                            <input placeholder="Email" name="email" id="email" type="email" class="validate" required [(ngModel)]="quotation.email" #email="ngModel">
                        </div>
                        <div class="col m6" style="padding-bottom: 5px">
                            <input placeholder="Código Postal" name="zipcode" type="text" class="validate {{zipcode==0 ?'invalid':''}}" required="true" minlength="5" maxlength="5" [(ngModel)]="quotation.zipcode" #zipcode="ngModel" (blur)="validateZipcode()">
                        </div>
                        <div class="col m6" style="padding-top: 10px">
                            <a (click)="setGender(2)" class="waves-effect waves-light btn {{quotation.gender==2 ? '' : 'btn-disabled'}}">H</a>
                            &nbsp;
                            <a (click)="setGender(1)" class="waves-effect waves-light btn {{quotation.gender==1 ? '' : 'btn-disabled'}}">M</a>
                        </div>
                        <div class="col m12" style="padding-bottom: 5px">
                            <input placeholder="Celular (Opcional)" name="cellphone" id="cellphone" type="text" class="validate" [(ngModel)]="quotation.cellphone" #cellphone="ngModel">
                        </div>
                        <div class="col m12">
                            <div class="row">
                                <div class="col m4">
                                    <select name="birth_day" [(ngModel)]="birth_day" (change)="setBirthDate();" class="browser-default " required="true" name="day_birth" id="day_birth">
                                        <option value="">dd</option>
                                        <option value="01">01</option>
                                        <option value="02">02</option>
                                        <option value="03">03</option>
                                        <option value="04">04</option>
                                        <option value="05">05</option>
                                        <option value="06">06</option>
                                        <option value="07">07</option>
                                        <option value="08">08</option>
                                        <option value="09">09</option>
                                        <option value="10">10</option>
                                        <option value="11">11</option>
                                        <option value="12">12</option>
                                        <option value="13">13</option>
                                        <option value="14">14</option>
                                        <option value="15">15</option>
                                        <option value="16">16</option>
                                        <option value="17">17</option>
                                        <option value="18">18</option>
                                        <option value="19">19</option>
                                        <option value="20">20</option>
                                        <option value="21">21</option>
                                        <option value="22">22</option>
                                        <option value="23">23</option>
                                        <option value="24">24</option>
                                        <option value="25">25</option>
                                        <option value="26">26</option>
                                        <option value="27">27</option>
                                        <option value="28">28</option>
                                        <option value="29">29</option>
                                        <option value="30">30</option>
                                        <option value="31">31</option>
                                    </select>
                                </div>
                                <div class="col m4">
                                    <select name="birth_month" [(ngModel)]="birth_month" (change)="setBirthDate();" class="browser-default " required="true" name="month_birth" id="month_birth">
                                        <option value="">mm</option>
                                        <option value="1">01</option>
                                        <option value="2">02</option>
                                        <option value="3">03</option>
                                        <option value="4">04</option>
                                        <option value="5">05</option>                                            <option value="6">06</option>
                                        <option value="7">07</option>
                                        <option value="8">08</option>
                                        <option value="9">09</option>
                                        <option value="10">10</option>
                                        <option value="11">11</option>
                                        <option value="12">12</option>
                                    </select>
                                </div>
                                <div class="col m4">
                                    <select (change)="setBirthDate();" [(ngModel)]="birth_year" class="browser-default " required="true" name="year_birth" id="year_birth">
                                        <option value="">yyyy</option>
                                        <option  *ngFor="let year of years_birth" value="{{year}}">{{year}}</option>
                                    </select>
                                </div>
                                <div class="col m12">
                                    <label style="color:red">{{error_date}}</label>
                                </div>
                            </div>	
                        </div>
                    </div>
                </div>
                <div class="col m12" style="padding-bottom: 5px">
                    <label>
                        <input type="checkbox" class="filled-in"  required="true" checked />
                        <span>El auto NO es legalizado, fronterizo o de salvamento y no tiene siniestros por reclamar.</span>
                    </label>
                </div>
                <div class="col m12" style="padding-bottom: 5px">
                    <label>
                        <input type="checkbox" class="filled-in"  required="true" checked/>
                        <span>El auto NO es utilizado para fines de carga, comercio o lucro.</span>
                    </label>
                </div>
                <div class="col m12" style="padding-bottom: 5px">
                    <label>
                        <input type="checkbox" class="filled-in"  required="true" checked/>
                        <span>El auto NO es Uber o similares.</span>
                    </label>
                </div>
                <div class="col m12" align="center">
                    <button onclick="" class="btn waves-effect waves-ligh btn-large" type="submit" name="action" >&nbsp;&nbsp;Cotizar &nbsp;&nbsp;
                    </button>
                </div>
            </div>	
        </form>
    </div>
</div>

<!-- Elimiar cotizacion-->
<div id="modal3" class="modal">
    <form #f="ngForm" (ngSubmit)="deleteQuoteModal()" ngNativeValidate>
        <div class="modal-content">
            <h4>Motivo por el cual se elimina la cotización</h4>
            <select [(ngModel)]="delete_quote.reason" name="reason" class="browser-default" required="true" >
                <option value="" disabled selected>Seleccionar</option>
                <option value="1">La cotización esta duplicada</option>
                <option value="2">Los datos del cliente no existen</option>
                <option value="3">El cliente pidió eliminarla</option>
                <option value="4">Los datos del auto no son correctos</option>
            </select>
            <br><br>
            <input  [(ngModel)]="delete_quote.password" placeholder="password" name="password" id="password" type="password" class="validate" style="background-color:#fff" required >
        </div>
        <div class="modal-footer">
            <button type="submit" class=" waves-effect waves-green btn-flat" >Eliminar</button>
        </div>
    </form>
</div>